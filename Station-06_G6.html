<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Schnitzeljagd ‚Äì Station 6</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  background:#0f172a;
  padding:24px;
  border-radius:16px;
  width:360px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}
h1{ text-align:center; color:#60a5fa; margin-top:0; }
#timer{ text-align:center; margin-bottom:12px; color:#a5f3fc; font-weight:bold; }

.section{ margin-bottom:18px; }
.section input{
  width:100%;
  box-sizing:border-box;
  padding:12px;
  border-radius:10px;
  border:1px solid #334155;
  background:#020617;
  color:#e5e7eb;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:white;
  font-weight:bold;
}
.hidden{display:none;}
.raetselBox{
  padding:16px;
  border-radius:14px;
  background:rgba(34,197,94,0.12);
  border:1px solid rgba(34,197,94,0.45);
  color:#bbf7d0;
}
.buchstabenBox{
  margin-top:20px;
  padding:16px;
  border-radius:14px;
  text-align:center;
  background:rgba(239,68,68,0.12);
  border:2px solid rgba(239,68,68,0.6);
}
.buchstabe{ font-size:3.5rem; font-weight:bold; color:#fecaca; }
</style>
</head>

<body>
<div class="card">

<div id="header">
  <h1>üìç Station 6</h1>
  <div id="timer">‚è±Ô∏è Zeit: 0 s</div>
</div>

<form id="formular"
 action="https://docs.google.com/forms/d/e/1FAIpQLSdULt5n9Mv6MJtZy1W7Y0RjT1_VW56ZkYACE-uukUErIK7trA/formResponse"
 method="POST" target="hidden_iframe"
 onsubmit="return auswerten();">

<input type="hidden" name="entry.2065943787" value="1">
<input type="hidden" name="entry.277494817" value="6">
<input type="hidden" name="entry.1434791088" id="hauptpunkte">
<input type="hidden" name="entry.68499526" id="bonuspunkte">
<input type="hidden" name="entry.2070741248" id="zeit">

<div id="gpsStatus" style="margin-bottom:12px;color:#fde68a;">
üì° Standort wird gepr√ºft ‚Ä¶
</div>

<div id="fragenBlock" class="hidden">

  <div class="section">
    <strong>üß© Hauptfrage</strong><br><br>
    Wie lang ist ein <strong>B-Schlauch</strong> plus ein <strong>C-Schlauch</strong> zusammen?
    <input id="hauptantwort" name="entry.634051671" required>
  </div>

  <div class="section">
    <strong>‚≠ê Bonusfrage</strong><br><br>
    Ab welchem Alter darf man bei der Feuerwehr starten?
    <input id="bonusantwort" name="entry.1320841054">
  </div>

  <button type="submit">Antworten absenden</button>
</div>
</form>

<div id="erfolg" class="hidden">
  <h2>üèÅ Schnitzeljagd beendet!</h2>

  <div class="raetselBox">
    Gl√ºckwunsch! üéâ<br><br>
    Ihr habt alle Stationen geschafft, R√§tsel gel√∂st und als Team zusammengearbeitet.<br><br>
    Jetzt wartet euer wohlverdientes Finale üöíüî•
  </div>

  <div class="buchstabenBox">
    <div>üîê Euer L√∂sungsbuchstabe</div>
    <div class="buchstabe">R</div>
  </div>
</div>

<iframe name="hidden_iframe" style="display:none;"></iframe>
</div>

<script>
let startZeit = null;
let timerInterval = null;

const ZIEL_LAT = 50.45363329279474;
const ZIEL_LON = 9.612188118314732;
const TOLERANZ = 65;

const RICHTIGE_LAENGE = "35";
const BONUSALTER = "10";

let gpsOK = false;

navigator.geolocation.getCurrentPosition(pos=>{
  const d = dist(pos.coords.latitude,pos.coords.longitude,ZIEL_LAT,ZIEL_LON);

  if(d <= TOLERANZ){
    gpsOK = true;
    document.getElementById("gpsStatus").innerText =
      "‚úÖ Standort best√§tigt ‚Äì letzte Aufgabe freigeschaltet";
    document.getElementById("fragenBlock").classList.remove("hidden");

    startZeit = Date.now();
    timerInterval = setInterval(()=>{
      document.getElementById("timer").innerText =
        "‚è±Ô∏è Zeit: " + Math.floor((Date.now()-startZeit)/1000) + " s";
    },1000);

  } else {
    document.getElementById("gpsStatus").innerText =
      "üìç Noch " + Math.round(d) + " m entfernt";
  }
});

function dist(a,b,c,d){
  const R=6371000;
  const x=(c-a)*Math.PI/180;
  const y=(d-b)*Math.PI/180;
  return R*2*Math.asin(Math.sqrt(
    Math.sin(x/2)**2 +
    Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)**2
  ));
}

function auswerten(){
  if(!gpsOK){
    alert("üìç Du bist noch nicht am richtigen Standort.");
    return false;
  }

  document.getElementById("zeit").value =
    Math.floor((Date.now()-startZeit)/1000);

  document.getElementById("hauptpunkte").value =
    document.getElementById("hauptantwort").value.trim()===RICHTIGE_LAENGE ? 10 : 0;

  document.getElementById("bonuspunkte").value =
    document.getElementById("bonusantwort").value.trim().includes(BONUSALTER) ? 10 : 0;

  clearInterval(timerInterval);
  document.getElementById("formular").classList.add("hidden");
  document.getElementById("header").classList.add("hidden");
  document.getElementById("erfolg").classList.remove("hidden");

  return true;
}
</script>
</body>
</html>
