<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Schnitzeljagd ‚Äì Station 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#020617;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.card{
  background:#0f172a;
  padding:24px;
  border-radius:16px;
  width:360px;
  box-shadow:0 20px 40px rgba(0,0,0,.6);
}
h1{
  text-align:center;
  color:#60a5fa;
  margin-top:0;
}
#timer{
  text-align:center;
  margin-bottom:14px;
  color:#a5f3fc;
  font-weight:bold;
}
.section{margin-bottom:18px;}
.section input{
  width:100%;
  box-sizing:border-box;
  padding:12px;
  border-radius:10px;
  border:1px solid #334155;
  background:#020617;
  color:#e5e7eb;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:#2563eb;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
.hidden{display:none;}
.erfolgBox{text-align:center;}
.checkIcon{
  width:48px;height:48px;
  margin:0 auto 12px;
  background:#22c55e;
  color:white;
  font-size:28px;
  border-radius:10px;
  display:flex;align-items:center;justify-content:center;
}
.raetselBox{
  padding:16px;border-radius:14px;
  background:rgba(34,197,94,0.12);
  border:1px solid rgba(34,197,94,0.45);
  color:#bbf7d0;
  line-height:1.6;
}
.buchstabenBox{
  margin-top:20px;
  padding:16px;
  border-radius:14px;
  text-align:center;
  background:rgba(239,68,68,0.12);
  border:2px solid rgba(239,68,68,0.6);
}
.buchstabe{
  font-size:3.5rem;
  font-weight:bold;
  color:#fecaca;
}
</style>
</head>

<body>

<div class="card">

<!-- HEADER -->
<div id="header">
  <h1>üìç Station 1</h1>
  <div id="timer">‚è±Ô∏è Zeit: 0 s</div>
</div>

<!-- GPS STATUS -->
<div id="gpsStatus" style="margin-bottom:14px;color:#fde68a;">
üì° Standort wird gepr√ºft ‚Ä¶
</div>

<!-- FORMULAR -->
<form
  id="formular"
  action="https://docs.google.com/forms/d/e/1FAIpQLSdULt5n9Mv6MJtZy1W7Y0RjT1_VW56ZkYACE-uukUErIK7trA/formResponse"
  method="POST"
  target="hidden_iframe"
  onsubmit="return auswerten();">

  <!-- feste Werte -->
  <input type="hidden" name="entry.2065943787" value="1">
  <input type="hidden" name="entry.277494817" value="1">
  <input type="hidden" name="entry.1434791088" id="punkte" value="0">
  <input type="hidden" name="entry.2070741248" id="zeit">

  <!-- FRAGEN -->
  <div id="fragenBlock" class="hidden">
    <div class="section">
      <strong>üß© Hauptfrage</strong><br><br>
      Wie lautet die europ√§ische Notrufnummer?<br><br>
      <input type="text"
             id="antwort"
             name="entry.634051671"
             placeholder="Antwort eingeben"
             required>
    </div>

    <button type="submit">Antworten absenden</button>
  </div>
</form>

<!-- ERFOLG -->
<div id="erfolg" class="hidden erfolgBox">
  <div class="checkIcon">‚úî</div>
  <div class="raetselBox">
    Kein Wohnort,<br>
    kein Ziel zum Bleiben.<br><br>

    Unter einem gro√üen Dach<br>
    wird Energie weitergegeben.<br><br>

    Findet den Ort,<br>
    an dem Fahrzeuge pausieren.
  </div>

  <div class="buchstabenBox">
    <div>üîê Euer L√∂sungsbuchstabe</div>
    <div class="buchstabe">T</div>
  </div>
</div>

<iframe name="hidden_iframe" style="display:none;"></iframe>

</div>

<script>
let start = null;
let gpsOK = false;

// ZIEL-KOORDINATEN
const ZIEL_LAT = 50.45363329279474;
const ZIEL_LON = 9.612188118314732;
const TOLERANZ = 30;

// GPS PR√úFEN
navigator.geolocation.getCurrentPosition(pos=>{
  const d = dist(
    pos.coords.latitude,
    pos.coords.longitude,
    ZIEL_LAT,
    ZIEL_LON
  );

  if(d <= TOLERANZ){
    gpsOK = true;
    document.getElementById("gpsStatus").innerText =
      "‚úÖ Standort best√§tigt ‚Äì Frage freigeschaltet";

    document.getElementById("fragenBlock").classList.remove("hidden");

    start = Date.now();
    setInterval(()=>{
      document.getElementById("timer").innerText =
        "‚è±Ô∏è Zeit: " + Math.floor((Date.now()-start)/1000) + " s";
    },1000);
  }else{
    document.getElementById("gpsStatus").innerText =
      `üìç Noch ${Math.round(d)} m entfernt`;
  }
},()=>{
  document.getElementById("gpsStatus").innerText =
    "üì° Standortfreigabe erforderlich";
});

function dist(lat1, lon1, lat2, lon2){
  const R = 6371000;
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a =
    Math.sin(dLat/2)**2 +
    Math.cos(lat1*Math.PI/180) *
    Math.cos(lat2*Math.PI/180) *
    Math.sin(dLon/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function auswerten(){
  if(!gpsOK) return false;

  document.getElementById("zeit").value =
    Math.floor((Date.now()-start)/1000);

  document.getElementById("punkte").value =
    document.getElementById("antwort").value.trim()==="112" ? 10 : 0;

  document.getElementById("formular").classList.add("hidden");
  document.getElementById("header").classList.add("hidden");
  document.getElementById("erfolg").classList.remove("hidden");

  return true;
}
</script>

</body>
</html>
